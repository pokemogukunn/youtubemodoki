<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Channel Videos</title>
</head>
<body>
    <h1>YouTube Channel Videos</h1>
    <ul id="video-list"></ul>

    <script>
        const API_KEY = 'AIzaSyA_RpiaJd_peLqI8a6mWiktRG1AE7sunYU';
        const CHANNEL_ID = 'UCqHkQwDjkEj4VjAP0gyxzOQ';
        const YOUTUBE_DL_SERVER = 'http://localhost:8080'; // youtube-dl-serverのURLを指定

        async function fetchVideos() {
            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=date&maxResults=20`);
                const data = await response.json();
                const videos = data.items;

                const videoList = document.getElementById('video-list');
                for (const video of videos) {
                    const videoId = video.id.videoId;
                    const videoItem = document.createElement('li');
                    videoItem.innerHTML = `
                        <h3>${video.snippet.title}</h3>
                        <p>${video.snippet.description}</p>
                        <img src="${video.snippet.thumbnails.default.url}" alt="${video.snippet.title}" id="thumbnail-${videoId}">
                    `;
                    videoList.appendChild(videoItem);

                    // サムネイル画像クリック時のイベントリスナーを追加
                    document.getElementById(`thumbnail-${videoId}`).addEventListener('click', async () => {
                        const dlResponse = await fetch(`${YOUTUBE_DL_SERVER}/download?url=https://www.youtube.com/watch?v=${videoId}`);
                        const dlData = await dlResponse.json();
                        const downloadUrl = dlData.url;

                        // 動画ストリームURLを開くか、mp4として保存
                        const a = document.createElement('a');
                        a.href = downloadUrl;
                        a.download = `${video.snippet.title}.mp4`; // ファイル名を設定
                        a.click();
                    });
                }
            } catch (error) {
                console.error('Error fetching videos:', error);
            }
        }

        fetchVideos();
    </script>
</body>
</html>
